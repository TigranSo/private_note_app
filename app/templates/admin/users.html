{% extends 'base.html' %}
{% block title %}Админ: пользователи{% endblock %}
{% block content %}
<h5 class="mb-3">Пользователи</h5>
<form class="row g-2 mb-3" method="post" action="{{ url_for('admin.create_user') }}">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <div class="col-md-4">
    <input class="form-control" name="email" type="email" placeholder="Email" required>
  </div>
  <div class="col-md-3">
    <input class="form-control" name="password" type="text" placeholder="Пароль" required>
  </div>
  <div class="col-md-2 form-check d-flex align-items-center">
    <input class="form-check-input" type="checkbox" name="is_admin" id="is_admin">
    <label class="form-check-label ms-2" for="is_admin">Админ</label>
  </div>
  <div class="col-md-3">
    <button class="btn btn-primary w-100" type="submit">Создать</button>
  </div>
</form>

<table class="table table-dark table-striped align-middle">
  <thead>
    <tr>
      <th>Email</th>
      <th>Имя</th>
      <th>Админ</th>
      <th>Квоты (шт/MB)</th>
      <th>Создан</th>
      <th class="text-end">Действия</th>
    </tr>
  </thead>
  <tbody>
    {% for u in users %}
    <tr>
      <td>{{ u.email }}</td>
      <td>{{ u.name or '' }}</td>
      <td>{{ 'Да' if u.is_admin else 'Нет' }}</td>
      <td>
        <form class="d-flex align-items-center gap-1" method="post" action="{{ url_for('admin.set_quota', user_id=u.id) }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <input class="form-control form-control-sm" style="width:80px" type="number" name="file_quota_count" value="{{ u.file_quota_count or '' }}" placeholder="шт">
          <input class="form-control form-control-sm" style="width:80px" type="number" name="file_quota_mb" value="{{ u.file_quota_mb or '' }}" placeholder="MB">
          <button class="btn btn-sm btn-outline-primary" type="submit">OK</button>
        </form>
      </td>
      <td>{{ u.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
      <td class="text-end">
        <form class="d-inline" method="post" action="{{ url_for('admin.reset_password', user_id=u.id) }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <input class="form-control form-control-sm d-inline-block w-auto" type="text" name="password" placeholder="Новый пароль">
          <button class="btn btn-sm btn-outline-warning" type="submit">Сбросить</button>
        </form>
        <form class="d-inline ms-2" method="post" action="{{ url_for('admin.delete_user', user_id=u.id) }}" onsubmit="return confirm('Удалить пользователя?');">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-sm btn-outline-danger" type="submit">Удалить</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
